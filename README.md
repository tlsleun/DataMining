# 기상변수에 따른 알레르기 질환의 발생 추이

[2024.03.11-2024.06.19]
- 2024년 1학기 데이터마이닝 수업에서 진행했던 프로젝트입니다. *A+*
- 사용 언어 : SAS, R, Python

## 주제선정 배경
- 최근 알레르기질환의 유병률은 증가하고 있으며, 기후 변화와 대기오염과 같은 환경요인이 유병률 증가의 원인으로 제시되고 있습니다.
  - 천식:
    - 2008년 WHO의 보고에 의하면 전 세계적으로 약 3억 명의 인구가 천식을 앓고 있으며, 매년 약 25만명이 천식으로 사망한다고 발표하였다.
  - 알레르기 비염 :
    -  같은 해 발표된 ARIA 가이드라인에 의하면, 알레르기 비염의 유병률도 지속적으로 증가하고 있으며, 특히 유럽 지역의 유병률은 약 25%로 보고되었습니다. <https://doi.org/10.4168/aard.2018.6.2.79>

- 알레르기 질환의 유병률이 증가하는 원인에는 여러 가지가 있지만 기후 변화에 의한 알레르기 유발물질, 즉 알레르겐의 변화가 대표적인 원인입니다. 또한, 환경오염의 심화가 알레르기 질환의 발생 및 악화를 부추기고 있는 만큼 기후 변화로 인한 이러한 현상은 앞으로도 더욱 가속화될 것으로 전망됩니다.
- 이에 따라, 기후 변화와 알레르기 질환의 유병률에 미치는 영향을 분석하고 상관관계를 알아보고자 하며 가장 영향을 끼치는 변수를 판단하려고 합니다.

 ## 데이터 정의
 ### 종속변수
| 질병데이터    |국민건강보험공단                          |
| ---------- | ---------------------------------------------- |
|Asthmapa|천식 환자수|
|Atopypa|아토피 환자수|
|rhinitispa|비염 환자수|

### 독립변수
| 관측데이터    |ASOS                          | 관측데이터    |ASOS                          | 대기오염 데이터    |서울열린데이터                          |
| ---------- | ---------------------------------------------- | ---------- | ---------------------------------------------- | ---------- | ---------------------------------------------- |
|meantem|평균기온|ave_dewpointtem|평균이슬점온도(°C)|av_NO2|평균이산화질소농도|
|lowesttem|최저기온|meanlowesttem|평균최저기온|av_O3|평균오존농도|
|highesttem|최고기온|meanhighesttem|평균최고기온|av_CO|평균일산화탄소농도|
|low_relhud|최소상대습도(%)|ave_waterpress|평균수증기압(hPa)|av_PM10|평균미세먼지농도|
|ave_relhud|평균상대습도(%)|hi_waterpress|최고수증기압(hPa)|av_PM2.5|평균초미세먼지농도|
|sumrainfall|월 합 강수량|low_waterpress|최저수증기압(hPa)|
|sum_sunhour|합계 일조시간|ave_groundtem|평균지면온도(°C)|
|hPa|평균현지기압|sol_radiation|일조율|
|UVI |자외선지수|sumrainfall|월합강수량(mm)|

 
 ## 데이터 EDA
[수집 데이터 : 2006-2022년]
종속변수는 각 질병의 환자수로 정의하며 천식, 아토피, 비염 총 3개의 종속변수로 진행함.
독립변수는 날씨변수와 대기오염변수로 정의함.

1. 결측치 처리
- NA값이 전체의 50% 이상 > 변수 제거
- 값이 없는 데이터(측정X)   > 전후 월 데이터의 평균으로 대체
- 이상치 > 표준화 : z-score가 2를 넘어가는 데이터를 이상치로 간주

2. 독립변수 정규화
- 독립변수 20개의 데이터 분포가 상이하여, 정규화(Regularization)를 진행해 모델에 적용함
- 종속변수는 3개의 질병 데이터의 크기 분포가 균일하여 전처리 하지 않고, 모델에 적용함

3. 상관분석(correlation analysis)
- 독립변수들의 연관성을 보고자 상관분석을 실행, 변수들이 서로 어떤 관계를 가지고 있는지 알기 위함
- 결과를 바탕으로 변수 간의 관계를 고려하여 모델을 설계함

![그림1](https://github.com/user-attachments/assets/0e8f84d0-e44e-4d83-bd57-25896ff6655f)

## 다중회귀모델
천식 모델의 MAPE = 18.17
아토피 모델의 MAPE = 5.00
비염 모델의 MAPE = 20.18
![image](https://github.com/user-attachments/assets/073f0fe7-6e8b-4197-8d58-7e2698f9b4f1)


## 로지스틱회귀모델
- 월별 데이터를 1-3월/4-6월-7-9월/10-12월 총 4개의 계절을 나눠 분할하며 각 계절의 평균 환자수보다 높은 데이터를 1, 낮은 데이터를 0으로 정의함(class).
- 총 8개의 범주가 생성 > 데이터를 병합하여 질병 데이터를 재정의함.
![image](https://github.com/user-attachments/assets/8dd3ac70-4faa-43b9-9af6-8098771575e0)
- 오즈비분석을 통해 중요한 변수의 영향력을 평가하거나, 결과 변수와 독립 변수 간의 관계를 이해하기 위해 사용함.


## 의사결정나무
### 아토피
- ROC 곡선으로 AUC값이 0.877인 것을 보아 모델이 잘 분류됐다는 것을 알 수 있습니다. 모델에서 오즈비 
분석을 통해 승산비도 검토해보았을 때, 기압 hpa 변수가 한단위 증가함에 따라 종속변수의 위험도는 4배 가까이 높아
지고, 평균이슬점농도가 한단위 증가함에 따라 위험도는 10배 가까이 높아진다는 것을 알 수 있습니다. 
- training의 auc 값은 0.9415, validation의 auc 값은 0.7150을 보았을 때, 모델이 과적합 되었다는 것을 알 수 있습니
다. 밑의 히스토그램 그래프는 의사결정나무에서 상위의 변수중요도의 나열입니다. 가장 높은 순위를 차지하는 합계 일
조시간을 기준으로, 평균미세먼지농도에 비해 약 1.25배 정도 더 아토피 환자수 증가에 영향을 미친다는 것을 알 수 
있습니다.


### 비염
- ROC 곡선으로 AUC값이 0.7790인 것을 보아 모델이 잘 분류됐다는 것을 알 수 있습니다. 모델에서 오즈비 분석을 통
해 승산비도 검토해보았을 때, 일조율 변수가 한단위 증가함에 따라 종속변수의 위험도는 14배 가까이 높아지고, 평균
이산화질소농도가 한 단위 증가함에 따라 위험도는 2.3배 가까이 높아진다는 것을 알 수 있습니다. 

- training의 auc 값은 0.9101, validation의 auc 값은 0.7382를 보았을 때, 모델이 과적합 되었다는 것을 알 수 있습니
다. 상위의 변수중요도를 보면, 가장 높은 순위를 차지하는 합계일사량을 기준으로, 평균풍속에 비해 약 1.66배 정도 
더 비염 환자수 증가에 영향을 미친다는 것을 알 수 있습니다. 


### 천식
= ROC 곡선으로 AUC값이 0.9374인 것을 보아 모델이 잘 분류됐다는 것을 알 수 있습니다. 모델에서 오즈비 분석을 통
해 승산비도 검토해보았을 때, 평균풍속 변수가 한단위 증가함에 따라 종속변수의 위험도는 2.4배 가까이 높아지고, 평
균이산화질소농도가 한단위 증가함에 따라 위험도는 48배 가까이 높아진다는 것을 알 수 있습니다. 
- training의 auc 값은 0.9928, validation의 auc 값은 0.9315를 보았을 때, 모델의 예측에 대한 적합도가 뛰어나다는 것
을 알 수 있습니다. 히스토그램에서 평균이산화질소농도를 1로 놓았을 때, 평균오존농도가 평균이산화질소농도에 비해 
약 1.4배 정도 더 비염 환자수 증가에 영향을 미친다는 것을 알 수 있습니다. 


### 결과 : 변수중요도
- 아토피  [합계일조시간> 평균일산화탄소농도> 최소상대습도> 평균미세먼지농도]
- 비염    [합계일사량> 합계일조시간> 최대풍속> 평균풍속]
- 천식    [평균기온> 평균오존농도> 평균이산화질소농도> 평균풍속]

## 향후연구방향
- 국민 안전 문자
아토피, 비염, 천식 모델에 환경성 알레르기 위험 지수를 도입하여 국민 안전 문자 전송으로 공공 서비스 제공함

- 역학 모델링
지리적 특성 및 위치에 따라 변화하는 기상 지수를 통해 환경성 알레르기 모델로 위험도 및 환자수 예측을 할 수 있는 역학조사 모델링을 도입함
